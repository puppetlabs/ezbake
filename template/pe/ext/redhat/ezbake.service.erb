[Unit]
Description=<%= EZBake::Config[:project] %> Service
After=syslog.target network.target pe-postgresql.service

[Service]
Type=simple
EnvironmentFile=/etc/sysconfig/<%= EZBake::Config[:project] %>
User=<%= EZBake::Config[:user] %>
TimeoutStartSec=120
TimeoutStopSec=60

ExecStart=/opt/puppet/bin/java $JAVA_ARGS \
          -XX:OnOutOfMemoryError=kill\ -9\ %p \
          -XX:+HeapDumpOnOutOfMemoryError \
          -XX:HeapDumpPath=/var/log/<%= EZBake::Config[:project] %> \
          -Djava.security.egd=/dev/urandom \
          -cp "${INSTALL_DIR}/<%= EZBake::Config[:uberjar_name] %>" clojure.main \
          -m <%= EZBake::Config[:main_namespace] %> \
          --config "${CONFIG}" \
          -b "${BOOTSTRAP_CONFIG}" $@

KillMode=process

ExecStartPost=/bin/bash "${INSTALL_DIR}/ezbake-functions.sh" wait_for_app

<% EZBake::Config[:redhat][:post_start_action].each do |action| -%>
ExecStartPost=-<%= action %>
<% end -%>
SuccessExitStatus=143

StandardOutput=syslog

[Install]
WantedBy=multi-user.target
